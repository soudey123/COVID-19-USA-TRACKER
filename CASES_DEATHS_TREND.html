<!DOCTYPE html>
<html lang="en">
<head>
    <title>CSS Website Layout</title>
    <meta charset="utf-8">
    <script src="https://d3js.org/d3.v4.min.js"></script>
    <script src="js/d3_annotation.js"></script>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <style>
        * {
            box-sizing: border-box;
        }
        /* AXES */
        /* ticks */
        .axis line{
            stroke: #1313a0;
            stroke-width: 0.5;
            shape-rendering: crispEdges;
        }

        /* axis contour */
        .axis path {
            stroke: #0a0a7d;
            stroke-width: 0.7;
            shape-rendering: crispEdges;
        }

        /* axis text */
        .axis text {
            fill: #2b2929;
            font-family: Georgia;
            font-size: 120%;
        }

        /* LINE CHART */
        .line {
            fill: none;
            stroke-width: 1px;
            stroke: #d2d2d2;
        }

        .ghost-line {
            fill: none;
            stroke: #0f2092;
            opacity: 0;
            stroke-width: 10px;
        }

        .serie_label {
            fill: #d2d2d2;
            font-family: Georgia;
            font-size: 100%;
        }

        body {
            margin: 0;
            font: 11px sans-serif;
            background-color: #ffffff;
            background-image: url('img/COVID19.jpg');
            background-repeat: no-repeat;
            background-attachment: fixed;
            background-size: 100% 100%;
        }

        .header h1 {
            height: 10px;
            top: 18px;
            left: 10px;
        }

        /* Style the top navigation bar */
        .topnav {
            overflow: hidden;
            background-color: #5a6ddc;
        }

        /* Style the topnav links */
        .topnav a {
            float: left;
            display: block;
            color: #f2f2f2;
            text-align: center;
            padding: 14px 16px;
            text-decoration: none;
        }

        /* Change color on hover */
        .topnav a:hover {
            background-color: #ddd;
            color: black;
        }

        /* Create three unequal columns that floats next to each other */
        .column {
            float: left;
            padding: 10px;
        }

        /* Left and right column */
        .column.side {
            width: 25%;
        }

        /* Middle column */
        .column.middle {
            width: 100%;
        }

        /* Clear floats after the columns */
        .row:after {
            content: "";
            display: table;
            clear: both;
            gap: 0px;
        }

        /* Responsive layout - makes the three columns stack on top of each other instead of next to each other */
        @media screen and (max-width: 600px) {
            .column.middle {
                width: 100%;
            }
        }

        .tooltip {
            placement: auto;
            position: absolute;
            display:inline;
            overflow:auto;
            font-size: 15px;
            width:  auto;
            height: auto;
            pointer-events: none;
            background-color: antiquewhite;
            color: midnightblue;
            padding: 0.3px;
        }

        /* Style the footer */
        .footer {
            background-color: #f1f1f1;
            padding: 10px;
            text-align: center;
        }

        .container{
            position: center;
            margin: 1px;
            width: 100%;
        }

        .axis text {
            font: 10px sans-serif;
        }

    </style>
</head>
<body>
<div class="header">
    <h1 style="text-align:center;color:floralwhite;font-family:courier;font-size:250%">COVID-19 USA DATA TRACKER</h1>
</div>
<div class="body">
    <div class="container">
        <div class="topnav">
            <a href="index.html">HOME</a>
            <a href="US_STATE_CASES_DEATHS.html">U.S. STATE DATA</a>
            <a href="Demographic.html">DEMOGRAPHIC DATA</a>
            <a href="CASES_DEATHS_TREND.html">TREND DATA</a>
        </div>
    </div>

    <div class="row">
        <div class="column middle">
            <p style="background-color:antiquewhite;font-family:Helvetica Neue;font-size:130%" align="justify"><b style="color: purple;font-size: 20px">COVID-19 Cases Trend By State:</b><br>The following line chart exhibits the COVID-19 cases trend reported in different U.S. states as of 07/15/2020. <br>Going by the trend line, it is observed that the COVID-19 cases reached peak stage in New York, New Jersey and Illinois. Moreover based on the following chart , there is a steep surge observed in Texas , California and Florida state. Arizona and Georgia states also reported recent surge in COVID-19 cases. Hover over the lines to get an interactive clear view.<br></p>
            <div id="my_dataviz" style="background-color:#f6f8f8;color:rgba(53,69,229,0.09);padding:10px;border: 5px outset #021d28">
            </div>
        </div>
        <div class="column middle">
            <p style="background-color:antiquewhite;font-family:Helvetica Neue;font-size:130%" align="justify"><b style="color: purple;font-size: 20px">Grid View Of COVID-19 Deaths Trend By State:</b><br>The following grid chart exhibits the COVID-19 deaths trend reported in different U.S. states as of 07/15/2020. Apart from New York and New Jersey other states did not report steep rise in COVID-19 deaths so far. However, as shown in the previous chart that there is a possibility to observe similar trend in states like Texas, California, Florida, Arizona and Illinois due to the exponential increase of COVID-19 cases for past one month.<br>In the following grid chart , the months are represented in numeric figure on X axis e.g. Feb=2,April=4 and June=6.<br></p>
            <div id="my_dataviz5" style="background-color:#f6f8f8;color:rgba(53,69,229,0.09);padding:10px;border: 5px outset #021d28"></div>
        </div>
    </div>
    <br>
    <footer>
        <p style="background-color:#ffffff;font-family:Helvetica Neue;font-size:130%" align="justify">
            <b>Reference:</b> For more information about COVID-19 disease please visit <a href="https://www.cdc.gov/coronavirus/2019-nCoV/index.html">https://www.cdc.gov/coronavirus/2019-nCoV/index.html</a>
            <br>
            <b>Data Courtesy:</b><a href="https://www.cdc.gov/"> https://www.cdc.gov/</a>
            <br>
            <b>Image Courtesy:</b><a href="https://phil.cdc.gov/Details.aspx?pid=23311"> https://phil.cdc.gov/Details.aspx?pid=23311</a>
            <br>
            <b>Viz creator:</b> Soumava Dey<br></p>
    </footer>

</div>
<script>

    //------------------------1. PREPARATION------------------------//
    //-----------------------------SVG------------------------------//
    var width = 760;
    var height = 300;
    var adj = 30;
    // we are appending SVG first
    var svg = d3.select("#my_dataviz").append("svg")
        .attr("preserveAspectRatio", "xMinYMin meet")
        .attr("viewBox", "-"
            + adj + " -"
            + adj + " "
            + (width + adj * 5) + " "
            + (height + adj * 5))

        .classed("svg-content", true);

    var color = d3.scaleOrdinal(d3.schemeCategory20);

    //-----------------------------DATA-----------------------------//
    const timeConv = d3.timeParse("%d-%b-%Y");
    d3.csv("data/covid_confirmed_usafacts.csv", function(data) {
        var slices = data.columns.slice(1).map(function(id) {
            return {
                id: id,
                values: data.map(function(d){
                    return {
                        date: timeConv(d.date),
                        measurement: +d[id]
                    };
                })
            };
        });

        console.log(slices)

//----------------------------SCALES----------------------------//
        const xScale = d3.scaleTime().range([0,width]);
        const yScale = d3.scaleLinear().rangeRound([height, 0]);
        xScale.domain(d3.extent(data, function(d){
            return timeConv(d.date)}));

        yScale.domain([(0), d3.max(slices, function(c) {
            return d3.max(c.values, function(d) {
                return d.measurement + 4; });
        })
        ]);

//-----------------------------AXES-----------------------------//
        const yaxis = d3.axisLeft()
            .ticks((slices[0].values).length-170)
            .scale(yScale);

        const xaxis = d3.axisBottom()
            .ticks(d3.timeDay.every(60))
            .tickFormat(d3.timeFormat('%b %d'))
            .scale(xScale);

//----------------------------LINES-----------------------------//
        const line = d3.line()
            .x(function(d) { return xScale(d.date); })
            .y(function(d) { return yScale(d.measurement); });

//-------------------------2. DRAWING---------------------------//
//-----------------------------AXES-----------------------------//
        svg.append("g")
            .attr("class", "axis")
            .attr("transform", "translate(0," + height + ")")
            .call(xaxis);

        svg.append("g")
            .attr("class", "axis")
            .call(yaxis)
            .append("text")
            .attr("transform", "rotate(-90)")
            .attr("dy", ".75em")
            .attr("y", 10)
            .style("text-anchor", "end")
            .text("Total Cases");

//----------------------------LINES-----------------------------//
        const lines = svg.selectAll("lines")
            .data(slices)
            .enter()
            .append("g");

        lines.append("path")
            .attr("class", "line")
            .attr("d", function(d) { return line(d.values); })
            .attr("stroke", function(d) { return color(d.id); });

        lines.append("text")
            .attr("class","serie_label")
            .datum(function(d) {
                return {
                    id: d.id,
                    value: d.values[d.values.length - 1]}; })
            .attr("transform", function(d) {
                return "translate(" + (xScale(d.value.date) + 10)
                    + "," + (yScale(d.value.measurement) + 5 )+ ")"; })
            .attr("x", 10)
            .text(function(d) { return d.id; })
            .style("fill", function(d) { return color(d.id); })

        const ghost_lines = lines.append("path")
            .attr("class", "ghost-line")
            .attr("d", function(d) { return line(d.values); })
            .attr("stroke", function(d) { return color(d.id); });

//---------------------------EVENTS-----------------------------//
        lines.selectAll(".ghost-line")
            .on('mouseover', function() {
                const selection = d3.select(this).raise();

                selection
                    .transition()
                    .delay("100").duration("10")
                    //.style("stroke","#ed3700")
                    .style("stroke", function(d) { return color(d.id); })
                    .style("opacity","1")
                    .style("stroke-width","3")

                // add the legend action
                const legend = d3.select(this.parentNode)
                    .select(".serie_label");

                legend
                    .transition()
                    .delay("100")
                    .duration("10")
                    //.style("fill","#2b2929");
                    .style("fill", function(d) { return color(d.id); })
            })



            .on('mouseout', function() {
                const selection = d3.select(this)

                selection
                    .transition()
                    .delay("100")
                    .duration("10")
                    .style("stroke","#d2d2d2")
                    .style("opacity","0")
                    .style("stroke-width","3");

                // add the legend action
                const legend = d3.select(this.parentNode)
                    .select(".serie_label");

                legend
                    .transition()
                    .delay("100")
                    .duration("10")
                    //.style("fill","#d2d2d2");
                    .style("fill", function(d) { return color(d.id); })
            })

    });



    ////////////////////////////////Beginning of death trend by state code //////////////////////

    // set the dimensions and margins of the graph
    var margin_line = {top: 30, right: 0, bottom: 30, left: 50},
        width_line = 210 - margin_line.left - margin_line.right,
        height_line = 210 - margin_line.top - margin_line.bottom;

    //Read the data
    d3.csv("data/covid_deaths_usafacts.csv", function(data) {

// group the data: I want to draw one line per group
        var sumstat = d3.nest() // nest function allows to group the calculation per level of a factor
            .key(function(d) { return d.State;})
            .entries(data);

// What is the list of groups?
        allKeys = sumstat.map(function(d){return d.key})

// Add an svg element for each group. The will be one beside each other and will go on the next row when no more room available
        var svg = d3.select("#my_dataviz5")
            .selectAll("uniqueChart")
            .data(sumstat)
            .enter()
            .append("svg")
            .attr("width", width_line + margin_line.left + margin_line.right)
            .attr("height", height_line + margin_line.top + margin_line.bottom)
            .append("g")
            .attr("transform",
                "translate(" + margin_line.left + "," + margin_line.top + ")");

// Add X axis --> it is a date format
        var x = d3.scaleLinear()
            .domain(d3.extent(data, function(d) { return d.Month; }))
            .range([ 0, width_line ]);
        svg
            .append("g")
            .attr("transform", "translate(0," + height_line + ")")
            .call(d3.axisBottom(x).ticks(3));

//Add Y axis
        var y = d3.scaleLinear()
            .domain([0, d3.max(data, function(d) { return +d.Death; })])
            .range([ height_line, 0 ]);
        svg.append("g")
            .call(d3.axisLeft(y).ticks(5));

// color palette
        var color = d3.scaleOrdinal()
            .domain(allKeys)
            .range(['#4daf4a','#377eb8','#e41a1c','#984ea3'])


//var color = d3.scaleOrdinal(d3.schemeCategory20);
// Draw the line
        svg
            .append("path")
            .attr("fill", "none")
            .attr("stroke", function(d){ return color(d.key) })
            .attr("stroke-width", 1.9)
            .attr("d", function(d){
                return d3.line()
                    .x(function(d) { return x(d.Month); })
                    .y(function(d) { return y(+d.Death); })
                    (d.values)
            })

// Add titles
        svg
            .append("text")
            .attr("text-anchor", "start")
            .attr("y", -5)
            .attr("x", 0)
            .text(function(d){ return(d.key)})
            .style("fill", function(d){ return color(d.key) })

    })

    ////////////////////////////////End of death trend by state code //////////////////////

</script>
</body>
</html>
