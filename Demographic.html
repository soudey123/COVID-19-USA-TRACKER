<!DOCTYPE html>
<html lang="en">
<head>
    <title>U.S. Demographic </title>
    <meta charset="utf-8">
    <script src="https://d3js.org/d3.v4.min.js"></script>
    <script src="js/d3_annotation.js"></script>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <style>
        * {
            box-sizing: border-box;
        }

        body {
            margin: 0;
            font: 11px sans-serif;
            background-color: #ffffff;
            background-image: url('img/COVID19.jpg');
            background-repeat: no-repeat;
            background-attachment: fixed;
            background-size: 100% 100%;
        }

        .header h1 {
            height: 10px;
            top: 18px;
            left: 10px;
        }

        /* Style the top navigation bar */
        .topnav {
            overflow: hidden;
            background-color: #5a6ddc;
        }

        /* Style the topnav links */
        .topnav a {
            float: left;
            display: block;
            color: #f2f2f2;
            text-align: center;
            padding: 10px 10px;
            text-decoration: none;
            font-size: medium;
        }

        /* Change color on hover */
        .topnav a:hover {
            background-color: #ddd;
            color: black;
        }

        /* Create three unequal columns that floats next to each other */
        .column {
            float: left;
            padding: 10px;
        }

        /* Left and right column */
        .column.side {
            width: 25%;
        }

        /* Middle column */
        .column.middle {
            width: 100%;
        }

        /* Clear floats after the columns */
        .row:after {
            content: "";
            display: table;
            clear: both;
            gap: 0px;
        }

        /* Responsive layout - makes the three columns stack on top of each other instead of next to each other */
        @media screen and (max-width: 600px) {
            .column.middle {
                width: 100%;
            }
        }

        .tooltip {
            placement: auto;
            position: absolute;
            display:inline;
            overflow:auto;
            font-size: 15px;
            width:  auto;
            height: auto;
            pointer-events: none;
            background-color: antiquewhite;
            color: midnightblue;
            padding: 0.3px;
        }

        /* Style the footer */
        .footer {
            background-color: #f1f1f1;
            padding: 10px;
            text-align: center;
        }

        .container{
            position: center;
            margin: 1px;
            width: 100%;
        }
    </style>
</head>
<body>

<div class="header">
    <h1 style="text-align:center;color:floralwhite;font-family:courier;font-size:250%">COVID-19 USA DATA TRACKER</h1>
</div>
<div class="body">
    <div class="container">
        <div class="topnav">
            <a href="index.html">U.S. MAP</a>
            <a href="US_STATE_CASES_DEATHS.html">U.S. STATE DATA</a>
            <a href="Demographic.html">DEMOGRAPHIC DATA</a>
            <a href="CASES_DEATHS_TREND.html">TREND DATA</a>
        </div>
    </div>
            <p style="background-color:aliceblue;font-family:Helvetica Neue;font-size:130%" align="justify"><b style="color: purple;font-size: 20px">Demographic Analysis#1:</b><br> The following interactive chart shows the cumulative COVID-19 deaths by sex and age group for the United States of 07/15/2020. Click the buttons to switch between two sets of data representation.<br> It illustrates a correlation that the COVID-19 transmitted disease is more fatal to older adults especially between age group "75-84 years" for Male and age group "85 years and above" for Female.<br></p>
            <div id="my_dataviz1" style="background-color:#f8f0e1;color:#eaba98;padding:10px;border: 5px outset #08080e">
                <div><button type="button" onclick="update('Male')">Male</button>
                    <button type="button" onclick="update('Female')">Female</button></div>
            </div>
            <br>
            <p style="background-color:aliceblue;font-family:Helvetica Neue;font-size:130%" align="justify"><b style="color: purple;font-size: 20px">Demographic Analysis#2:</b><br> The following bubble chart shows the distribution of COVID-19 deaths by race and Hispanic origin as of 07/15/2020 which creates an avenue to perform further analysis about the differential impact of COVID-19 deaths on these populations.<br>Hover over the bubbles to see addition details about those demographics as such a) death distribution percentage,b) population distribution percentage. It has been observed that there is a correlation between death and population percentage. <br><br>For instance, COVID-19 fatality reported more in White American population as compared to other minorities. It might be due to the fact that White American are the majority as they represent 60.4% of the U.S. population followed by Hispanic/Latino and Black/African American .However, there are more COVID-19 deaths observed in Black/African American community than that of Hispanic/Latino community though the latter has higher population density as compared to the former.<br></p>
            <div id="my_dataviz6" style="background-color:#f8f0e1;color:#cfffff;padding:10px;border: 5px outset #080817"></div>
            <br>
            <p style="background-color:aliceblue;font-family:Helvetica Neue;font-size:130%" align="justify"><b style="color: purple;font-size: 20px">Demographic Analysis#3:</b><br>In order to continue further analysis about the COVID-19 deaths impact on these population, the following bubble chart has been crafted to show the mortality rate distribution of COVID-19 deaths reported in different communities.Hover over the bubbles to see addition details about those demographics which are not covered in the bubble chart mentioned above.<br>Based on the mortality rate distribution, the White American community doesnâ€™t top the list whereas highest mortality rate distribution observed in the Black/African American community. Here is a brief demographic analysis summary derived from the two bubble charts:<br><br> 1) White American community reported highest COVID-19 deaths by count,<br> 2) Black/African community reported highest COVID-19 mortality rate per 100k population, <br> 3) although American Indian/Alaska Native reported lowest COVID-19 deaths by count but in general the COVID-19 mortality rate is higher compared to that of White American, Asian and Other communities.<br></p>
            <div id="my_dataviz7" style="background-color:#f8f0e1;color:#cfffff;padding:10px;border: 5px outset #080817"></div>
            <br>
    <br>
    <footer>
        <p style="background-color:aliceblue;font-family:Helvetica Neue;font-size:130%" align="justify">
            <b>Reference:</b> For more information about COVID-19 disease please visit <a href="https://www.cdc.gov/coronavirus/2019-nCoV/index.html">https://www.cdc.gov/coronavirus/2019-nCoV/index.html</a>
            <br>
            <b>Data Courtesy:</b><a href="https://www.cdc.gov/"> https://www.cdc.gov/</a>
            <br>
            <b>Image Courtesy:</b><a href="https://phil.cdc.gov/Details.aspx?pid=23311"> https://phil.cdc.gov/Details.aspx?pid=23311</a>
            <br>
            <b>Viz creator:</b> Soumava Dey<br></p>
    </footer>
</div>

<script type="text/javascript">

////////////////////////////////Beginning of Demographic analysis#1 code //////////////////////

    // set the dimensions and margins of the graph
    var margin = {top: 50, right: 30, bottom: 80, left: 60},
        width = 1060 - margin.left - margin.right,
        height = 400 - margin.top - margin.bottom;

    // append the svg object to the body of the page
    var svg1 = d3.select("#my_dataviz1")
        .append("svg")
        .attr("width", width + margin.left + margin.right)
        .attr("height", height + margin.top + margin.bottom)
        .append("g")
        .attr("transform",
            "translate(" + margin.left + "," + margin.top + ")");

    //var tooltip = d3.select("body").append("div").attr("class", "toolTip");
    // Initialize the X axis
    var x1 = d3.scaleBand()
        .range([ 0, width ])
        .padding(0.2);
    var xAxis1 = svg1.append("g")
        .attr("transform", "translate(0," + height + ")")

    // Initialize the Y axis
    var y1 = d3.scaleLinear()
        .range([ height, 0]);
    var yAxis1 = svg1.append("g")
        .attr("class", "myYaxis")

    svg1.append("text")
        .attr("x", (width / 2))
        .attr("y", 500)
        .attr("text-anchor", "middle")
        .style("font-size", "20px")
        .style("text-decoration", "underline")
        .text("COVID-19 Death By Gender and Age");

    // A function that create / update the plot for a given variable:
    function update(selectedVar) {

        // Parse the Data
        d3.csv("data/COVID_AGE_GENDER.csv", function(data) {

            //var color = d3.scaleLinear().domain(data)
            //.range(["green","blue","red"])
            //var colorScale = d3.category20c();
            // X axis
            x1.domain(data.map(function(d) { return d.Group; }))
            xAxis1.transition().duration(1000).call(d3.axisBottom(x1)).selectAll("text")
                .attr("transform", "translate(-10,0)rotate(-45)")
                .style("text-anchor", "end");

            // text label for the x axis
            svg1.append("text")
                .attr("transform",
                    "translate(" + (width/2) + " ," +
                    (height + margin.top + 20) + ")")
                .style("text-anchor", "middle")
                .text("Age Group");

            // Add Y axis
            y1.domain([0, d3.max(data, function(d) { return +d[selectedVar] }) ]);
            yAxis1.transition().duration(1000).call(d3.axisLeft(y1));

            svg1.append("text")
                .attr("transform", "rotate(-90)")
                .attr("y", 0 - margin.left)
                .attr("x",0 - (height / 2))
                .attr("dy", "1em")
                .style("text-anchor", "middle")
                .text("Total Deaths");
            //color.domain(data.map(function (d){ return d.Group; }));

            // variable u: map data to existing bars
            var u = svg1.selectAll("rect")
                .data(data)

            // update bars
            u
                .enter()
                .append("rect")
                .merge(u)
                .transition()
                .duration(1000)
                .attr("x", function(d) { return x1(d.Group); })
                .attr("y", function(d) { return y1(d[selectedVar]); })
                .attr("width", x1.bandwidth())
                .attr("height", function(d) { return height - y1(d[selectedVar]); })
                //.attr("fill", function(d){return colorScale(d.Group); })
                .attr("fill", "#3b6199")


        })}

    update('Male')

    ////////////////////////////////End of Demographic analysis#1 code //////////////////////

    ////////////////////////////////Beginning of Demographic analysis#2 code //////////////////////

    // Data is hard coded based on the information gathered from the CDC website.Link: https://data.cdc.gov/NCHS/Provisional-Death-Counts-for-Coronavirus-Disease-C/pj7m-y5uh/data
    dataset = {
        "children": [{"Name":"White","Count":64073,"Death_Percentage_Distribution":52.8,"Population_Distribution":60.4},
            {"Name":"Black/African American","Count":27848,"Death_Percentage_Distribution":22.9,"Population_Distribution":12.5},
            {"Name":"American Indian/Alaska Native","Count":974,"Death_Percentage_Distribution":0.8,"Population_Distribution":0.7},
            {"Name":"Asian","Count":6022,"Death_Percentage_Distribution":5,"Population_Distribution":5.7},
            {"Name":"Hispanic/Latino","Count":20849,"Death_Percentage_Distribution":17.2,"Population_Distribution":18.3},
            {"Name":"Other","Count":1608,"Death_Percentage_Distribution":1.3,"Population_Distribution":2.4}]
    };

    var diameter = 750;
    var color = d3.scaleOrdinal(d3.schemeCategory20);


    var bubble = d3.pack(dataset)
        .size([diameter, diameter])
        .padding(2);
    console.log(bubble)

    var svg_bubble = d3.select("#my_dataviz6")
        .append("svg")
        .attr("width", diameter)
        .attr("height", diameter)
        .attr("class", "bubble");

    //arrow
    svg_bubble.append("svg:defs").append("svg:marker")
        .attr("id", "triangle")
        .attr("refX", 6)
        .attr("refY", 6)
        .attr("markerWidth", 30)
        .attr("markerHeight", 30)
        .attr("markerUnits","userSpaceOnUse")
        .attr("orient", "auto")
        .append("path")
        .attr("d", "M 0 0 12 6 0 12 3 6")
        .style("fill", "red");

    //line
    svg_bubble.append("line")
        .attr("x1", 250)
        .attr("y1", 610)
        .attr("x2", 433)
        .attr("y2", 469)

        .attr("stroke-width", 2)
        .attr("stroke", "red")
        .attr("marker-end", "url(#triangle)");

    svg_bubble.append("text")
        .attr("x",13)
        .attr("y",625)
        .attr("font-family","sans-serif")
        .attr("font-size",12)
        .style("fill", "red")
        .text("Least deaths reported in American Indian/Alaska Native race");


    var tooltip_bubble = d3.select("#my_dataviz6").append("div")
        .attr("class", "tooltip")
        .style("opacity", 0);

    var nodes = d3.hierarchy(dataset)
        .sum(function(d) { return d.Count; });
    console.log(nodes)

    var node = svg_bubble.selectAll(".node")
        .data(bubble(nodes).descendants())
        .enter()
        .filter(function(d){
            return  !d.children
        })
        .append("g")
        //.call(makeAnnotationsRight_bubble)
        .attr("class", "node")
        .attr("transform", function(d) {
            console.log(d.x);
            return "translate(" + d.x + "," + d.y + ")";
        });


    node.append("circle")
        .attr("r", function(d) {
            return d.r;
        })
        .style("fill", function(d,i) {
            return color(i);
        })
        .on("mouseover", function(d) {
            var html  = "<span><b style='color: midnightblue'> Race : </b>" + d.data.Name+ "</span><br/>" +
                "<b style='color: darkred'> Total Deaths: <b/>" + d.data.Count+"<br/>"+
                "<b style='color: red'> Death Distribution Percentage: <b/>" + d.data.Death_Percentage_Distribution+"<br/>"+
                "<b style='color: darkblue'> Population Distribution Percentage: <b/>" + d.data.Population_Distribution

            tooltip_bubble.html(html)
                .style("left", (d3.event.pageX + 25) + "px")
                .style("top", (d3.event.pageY - 28) + "px")
                .transition()
                .duration(200) // ms
                .style("opacity", .9) // started as 0!

        })

        .on("mouseout", function(d) {
            tooltip_bubble.transition()
                .duration(300) // ms
                .style("opacity", 0); // don't care about position!
        })

    node.append("text")
        .attr("dy", ".2em")
        .style("text-anchor", "middle")
        .text(function(d) {
            return d.data.Name.substring(0, d.r / 3);
        })
        .attr("font-family", "sans-serif")
        .attr("font-size", function(d){
            return d.r/5;
        })
        .attr("fill", "white")
        .on("mouseover", function(d) {
            var html  = "<span><b> Race : </b>" + d.data.Name+ "</span><br/>" +
                "<b style='color: darkred'> Total Deaths: <b/>" + d.data.Count+"<br/>"+
                "<b style='color: red'> Death Distribution Percentage: <b/>" + d.data.Death_Percentage_Distribution+"<br/>"+
                "<b style='color: darkblue'> Population Distribution Percentage: <b/>" + d.data.Population_Distribution;

            tooltip_bubble.html(html)
                .style("left", (d3.event.pageX + 25) + "px")
                .style("top", (d3.event.pageY - 28) + "px")
                .transition()
                .duration(200) // ms
                .style("opacity", .9) // started as 0!

        })

        .on("mouseout", function(d) {
            tooltip_bubble.transition()
                .duration(300) // ms
                .style("opacity", 0); // don't care about position!
        })


    node.append("text")
        .attr("dy", "1.3em")
        .style("text-anchor", "middle")
        .text(function(d) {
            return d.data.Count;
        })

        .attr("font-size", function(d){
            return d.r/6;
        })
        .attr("fill", "white")
        .on("mouseover", function(d) {
            var html  = "<span><b> Race : </b>" + d.data.Name+ "</span><br/>" +
                "<b style='color: darkred'> Total Deaths: <b/>" + d.data.Count+"<br/>"+
                "<b style='color: red'> Death Distribution Percentage: <b/>" + d.data.Death_Percentage_Distribution+"<br/>"+
                "<b style='color: darkblue'> Population Distribution Percentage: <b/>" + d.data.Population_Distribution;

            tooltip_bubble.html(html)
                .style("left", (d3.event.pageX + 25) + "px")
                .style("top", (d3.event.pageY - 28) + "px")
                .transition()
                .duration(200) // ms
                .style("opacity", .9) // started as 0!

        })

        .on("mouseout", function(d) {
            tooltip_bubble.transition()
                .duration(300) // ms
                .style("opacity", 0); // don't care about position!
        })


    d3.select(self.frameElement)
        .style("height", diameter + "px");

    ////////////////////////////////End of Demographic analysis#2 code //////////////////////

    ////////////////////////////////Beginning of Demographic analysis#3 code //////////////////////

    // Data is hard coded based on the information gathered from the CDC website. Link: https://data.cdc.gov/NCHS/Provisional-Death-Counts-for-Coronavirus-Disease-C/pj7m-y5uh/data
    dataset = {
        "children": [{"Name":"White","Mortality_Percentage_Distribution":14,"Total_Population":198232800},
            {"Name":"Black/African American","Mortality_Percentage_Distribution":30,"Total_Population":41025000},
            {"Name":"American Indian/Alaska","Mortality_Percentage_Distribution":18,"Total_Population":2297400},
            {"Name":"Asian","Mortality_Percentage_Distribution":14,"Total_Population":18707400},
            {"Name":"Hispanic/Latino","Mortality_Percentage_Distribution":15,"Total_Population":60060600},
            {"Name":"Other","Mortality_Percentage_Distribution":9,"Total_Population":7876800}]
    };

    var diameter = 750;
    var color = d3.scaleOrdinal(d3.schemeCategory20);



    var bubble1 = d3.pack(dataset)
        .size([diameter, diameter])
        .padding(2);

    var svg_bubble1 = d3.select("#my_dataviz7")
        .append("svg")
        .attr("width", diameter)
        .attr("height", diameter)
        .attr("class", "bubble");

    var tooltip_bubble1 = d3.select("#my_dataviz7").append("div")
        .attr("class", "tooltip")
        .style("opacity", 0);

    var nodes1 = d3.hierarchy(dataset)
        .sum(function(d) { return d.Mortality_Percentage_Distribution; });
    console.log(nodes1)

    var node1 = svg_bubble1.selectAll(".node")
        .data(bubble1(nodes1).descendants())
        .enter()
        .filter(function(d){
            return  !d.children
        })
        .append("g")
        //.call(makeAnnotationsRight_bubble1)
        .attr("class", "node")
        .attr("transform", function(d) {
            console.log(d.x);
            return "translate(" + d.x + "," + d.y + ")";
        });


    node1.append("circle")
        .attr("r", function(d) {
            return d.r;
        })
        .style("fill", function(d,i) {
            return color(i);
        })
        .on("mouseover", function(d) {
            var html  = "<span><b style='color: midnightblue'> Race: </b>" + d.data.Name+ "</span><br/>" +
                "<b style='color: darkslateblue'> Total Population: <b/>" + d.data.Total_Population+"<br/>"+
                "<b style='color: red'> Mortality Percentage Distribution: <b/>" + d.data.Mortality_Percentage_Distribution+"<br/>"

            tooltip_bubble1.html(html)
                .style("left", (d3.event.pageX + 25) + "px")
                .style("top", (d3.event.pageY - 28) + "px")
                .transition()
                .duration(200) // ms
                .style("opacity", .9) // started as 0!

        })

        .on("mouseout", function(d) {
            tooltip_bubble1.transition()
                .duration(300) // ms
                .style("opacity", 0); // don't care about position!
        })

    node1.append("text")
        .attr("dy", ".2em")
        .style("text-anchor", "middle")
        .text(function(d) {
            return d.data.Name.substring(0, d.r / 3);
        })
        .attr("font-family", "sans-serif")
        .attr("font-size", function(d){
            return d.r/5;
        })
        .attr("fill", "white")
        .on("mouseover", function(d) {
            var html  = "<span><b style='color: midnightblue'> Race: </b>" + d.data.Name+ "</span><br/>" +
                "<b style='color: darkslateblue'> Total Population: <b/>" + d.data.Total_Population+"<br/>"+
                "<b style='color: red'> Mortality Percentage Distribution: <b/>" + d.data.Mortality_Percentage_Distribution+"<br/>"

            tooltip_bubble1.html(html)
                .style("left", (d3.event.pageX + 25) + "px")
                .style("top", (d3.event.pageY - 28) + "px")
                .transition()
                .duration(200) // ms
                .style("opacity", .9) // started as 0!

        })

        .on("mouseout", function(d) {
            tooltip_bubble1.transition()
                .duration(300) // ms
                .style("opacity", 0); // don't care about position!
        })


    node1.append("text")
        .attr("dy", "1.3em")
        .style("text-anchor", "middle")
        .text(function(d) {
            return d.data.Mortality_Percentage_Distribution;
        })

        .attr("font-size", function(d){
            return d.r/6;
        })
        .attr("fill", "white")
        .on("mouseover", function(d) {
            var html  = "<span><b style='color: midnightblue'> Race: </b>" + d.data.Name+ "</span><br/>" +
                "<b style='color: darkslateblue'> Total Population: <b/>" + d.data.Total_Population+"<br/>"+
                "<b style='color: red'> Mortality Percentage Distribution: <b/>" + d.data.Mortality_Percentage_Distribution+"<br/>"
            ;

            tooltip_bubble1.html(html)
                .style("left", (d3.event.pageX + 25) + "px")
                .style("top", (d3.event.pageY - 28) + "px")
                .transition()
                .duration(200) // ms
                .style("opacity", .9) // started as 0!

        })

        .on("mouseout", function(d) {
            tooltip_bubble1.transition()
                .duration(300) // ms
                .style("opacity", 0); // don't care about position!
        })


    d3.select(self.frameElement)
        .style("height", diameter + "px");

    ////////////////////////////////End of Demographic analysis#3 code //////////////////////

</script>

</body>
<html>




